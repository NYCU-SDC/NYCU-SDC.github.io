---
import { type CollectionEntry, getCollection, render } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map(post => ({
		params: { slug: post.id },
		props: post
	}));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content } = await render(post);
const postDate = post.data.pubDate || post.data.date;
---

<Layout title={post.data.title} description={post.data.description}>
	<article>
		<div class="hero-image">
			{post.data.heroImage && <Image width={1020} height={510} src={post.data.heroImage} alt="" />}
		</div>
		<div class="prose">
			<div class="title">
				<h1>{post.data.title}</h1>
				{postDate && (
					<div class="date">
						<FormattedDate date={postDate} />
						{post.data.updatedDate && (
							<div class="last-updated-on">
								Last updated on <FormattedDate date={post.data.updatedDate} />
							</div>
						)}
					</div>
				)}
				{post.data.author && <p class="author">By {post.data.author}</p>}
				<hr />
			</div>
			<Content />
		</div>
	</article>
	<style>
		article {
			max-width: var(--content-width);
			margin: 0 auto;
			padding: 2rem 1rem;
		}

		.hero-image {
			width: 100%;
			margin-bottom: 2rem;
		}

		.hero-image img {
			display: block;
			margin: 0 auto;
			border-radius: 12px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			width: 100%;
			height: auto;
		}

		.title {
			margin-bottom: 2rem;
		}

		.title h1 {
			margin: 0 0 0.5rem 0;
			color: var(--nord1);
			font-size: 2.5rem;
			line-height: 1.2;
		}

		.date {
			color: var(--nord3);
			margin-bottom: 0.5rem;
		}

		.last-updated-on {
			font-style: italic;
			font-size: 0.9rem;
			margin-top: 0.25rem;
		}

		.author {
			color: var(--nord3);
			font-size: 1rem;
			margin: 0.5rem 0;
		}

		.title hr {
			border: none;
			border-top: 1px solid var(--nord5);
			margin: 1.5rem 0;
		}

		.prose {
			font-size: 1.1rem;
			line-height: 1.8;
		}

		.prose :global(h1),
		.prose :global(h2),
		.prose :global(h3),
		.prose :global(h4),
		.prose :global(h5),
		.prose :global(h6) {
			color: var(--nord1);
			margin: 2rem 0 1rem;
			line-height: 1.3;
		}

		.prose :global(h1) {
			font-size: 2rem;
		}

		.prose :global(h2) {
			font-size: 1.75rem;
		}

		.prose :global(h3) {
			font-size: 1.5rem;
		}

		.prose :global(p) {
			margin: 1rem 0;
		}

		.prose :global(a) {
			color: var(--primary);
			text-decoration: underline;
			transition: opacity 0.2s ease;
		}

		.prose :global(a:hover) {
			opacity: 0.8;
		}

		.prose :global(code) {
			background-color: var(--nord6);
			padding: 0.2rem 0.4rem;
			border-radius: 4px;
			font-size: 0.9em;
			font-family: "Courier New", monospace;
		}

		.prose :global(pre) {
			background-color: var(--nord0);
			color: var(--nord6);
			padding: 1rem;
			border-radius: 8px;
			overflow-x: auto;
			margin: 1.5rem 0;
		}

		.prose :global(pre code) {
			background-color: transparent;
			padding: 0;
			color: inherit;
		}

		.prose :global(blockquote) {
			border-left: 4px solid var(--primary);
			padding-left: 1rem;
			margin: 1.5rem 0;
			font-style: italic;
			color: var(--nord3);
		}

		.prose :global(ul),
		.prose :global(ol) {
			margin: 1rem 0;
			padding-left: 2rem;
		}

		.prose :global(li) {
			margin: 0.5rem 0;
		}

		.prose :global(img) {
			max-width: 100%;
			height: auto;
			border-radius: 8px;
			margin: 1.5rem 0;
		}

		@media (max-width: 768px) {
			.title h1 {
				font-size: 2rem;
			}

			.prose {
				font-size: 1rem;
			}

			.prose :global(h1) {
				font-size: 1.75rem;
			}

			.prose :global(h2) {
				font-size: 1.5rem;
			}

			.prose :global(h3) {
				font-size: 1.25rem;
			}
		}
	</style>
</Layout>
