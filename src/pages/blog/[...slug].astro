---
import { type CollectionEntry, getCollection, render } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map(post => ({
		params: { slug: post.id },
		props: post
	}));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content } = await render(post);
const postDate = post.data.pubDate || post.data.date;
---

<Layout title={post.data.title} description={post.data.description}>
	<article>
		<div class="prose">
			<div 
				class="title"
				style={post.data.heroImage ? `background-image: linear-gradient(0deg, rgba(229, 233, 240, 0.86) 0%, rgba(229, 233, 240, 0.86) 100%), url('${post.data.heroImage.src}');` : ''}
			>
				{postDate && (
					<div class="date">
						<FormattedDate date={postDate} />
						{post.data.updatedDate && (
							<div class="last-updated-on">
								Last updated on <FormattedDate date={post.data.updatedDate} />
							</div>
						)}
					</div>
				)}
				<h1 style="font-family: Goldman;">{post.data.title}</h1>
				<span class="type">{post.data.type}</span>
			</div>
			{post.data.author && <p class="author">By {post.data.author}</p>}
			{post.data.description && <p class="description">{post.data.description}</p>}
			<Content />
		</div>
	</article>
	<style>
		article {
			max-width: var(--content-width);
			margin: 0 auto;
			padding: 2rem 1rem;
		}
		.title {
			margin-bottom: 2rem;
			padding: 2rem 1rem;
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			height: 33rem;
			width: 100vw;
			margin-left: calc(50% - 50vw);
			margin-top: -6.5rem;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			text-align: center;
			gap: 1rem;
		}
		.title h1 {
			margin: 0 0 0.5rem 0;
			color: var(--nord1);
			font-size: 3.5rem;
			line-height: 1.2;
		}

		.date {
			color: var(--nord3);
			margin-bottom: 0.5rem;
			font-size: 1rem;
			font-family: "Goldman";
		}

		.type {
			padding: 0.25rem 2rem;
			border-radius: 10000px;
			background: rgba(255, 255, 255, 0.43);
			font-family: "Goldman";
		}

		.last-updated-on {
			font-style: italic;
			font-size: 0.9rem;
			margin-top: 0.25rem;
		}

		.prose .author {
			color: var(--nord3);
			font-size: 1rem;
			margin: 1rem 0 2rem 0;
			font-family: "Goldman";
		}

		.prose .description {
			margin-bottom: 3rem;
			font-family: "Goldman";
		}

		.title hr {
			border: none;
			border-top: 1px solid var(--nord5);
			margin: 1.5rem 0;
		}

		.prose {
			font-size: 1.1rem;
			line-height: 1.8;
			font-family: "GenSekiGothicTW", sans-serif;
		}

		.prose :global(h1),
		.prose :global(h2),
		.prose :global(h3),
		.prose :global(h4),
		.prose :global(h5),
		.prose :global(h6) {
			color: var(--nord1);
			margin: 2rem 0 1rem;
			line-height: 1.3;
			font-family: "Goldman";
		}

		.prose :global(h1) {
			font-size: 2.5rem;
		}

		.prose :global(h2) {
			font-size: 2rem;
		}

		.prose :global(h3) {
			font-size: 1.6rem;
		}

		.prose :global(h4) {
			font-size: 1.5rem;
		}

		.prose :global(h4) {
			font-size: 1.125rem;
		}

		.prose :global(p) {
			margin: 1rem 0;
		}

		.prose :global(a) {
			color: var(--primary);
			text-decoration: underline;
			transition: opacity 0.2s ease;
		}

		.prose :global(a:hover) {
			opacity: 0.8;
		}

		.prose :global(code) {
			background: var(--nord4, #D8DEE9);
			padding: 0.2rem 0.4rem;
			border-radius: 4px;
			font-size: 0.9em;
			font-family: "Fira Code", monospace;
		}

		.prose :global(pre) {
			background-color: var(--nord1) !important;
			color: #FFF;
			padding: 1rem 2rem;
			border-radius: 1rem;
			overflow-x: auto;
			margin: 1.5rem 6.5rem;
		}

		.prose :global(pre code) {
			font-family: "Fira Code", monospace;
			background-color: transparent;
			padding: 0;
			color: inherit;
		}

		.prose :global(blockquote) {
			padding-left: 4rem;
			margin: 3rem 0;
			position: relative;
		}

		.prose :global(blockquote::before) {
			content: 'â€œ';
			position: absolute;
			left: 1rem;
			top: -0.5rem;
			font-size: 3rem;
			font-family: "Goldman";
			color: var(--nord1, #3B4252);
			line-height: 1;
		}

		.prose :global(ul),
		.prose :global(ol) {
			margin: 1rem 0;
			padding-left: 2rem;
		}

		.prose :global(li) {
			margin: 0.5rem 0;
		}

		.prose :global(img) {
			max-width: 100%;
			height: auto;
			border-radius: 8px;
			margin: 1.5rem 0;
		}

		.prose :global(table) {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
			margin: 2rem 0;
			font-size: 1rem;
			border-radius: 0.25rem;
			border: 0.5px solid var(--nord4, #D8DEE9);
		}

		.prose :global(thead) {
			background: var(--nord5, #E5E9F0);
		}

		.prose :global(th) {
			padding: 0.5rem 1rem;
			text-align: left;
			font-weight: 600;
			color: var(--nord1);
			border: 1px solid var(--nord4, #D8DEE9);
		}

		.prose :global(td) {
			padding: 0.5rem 1rem;
			border: 1px solid var(--nord4, #D8DEE9);
		}

		@media (max-width: 768px) {
			.title h1 {
				font-size: 2rem;
			}

			.prose {
				font-size: 1rem;
			}

			.prose :global(h1) {
				font-size: 1.75rem;
			}

			.prose :global(h2) {
				font-size: 1.5rem;
			}

			.prose :global(h3) {
				font-size: 1.25rem;
			}
			
			.prose :global(pre) {
				margin: 1.5rem 1rem;
			}
		}
	</style>
</Layout>
